â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                      CARD DATA FLOW - VISUAL GUIDE                             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ LIVE GAME FLOW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                   â”‚
â”‚  Player.log (JSON events)                                                        â”‚
â”‚       â†“                                                                           â”‚
â”‚  LogFollower (monitor for changes)                                               â”‚
â”‚       â†“                                                                           â”‚
â”‚  JSON parser (extract GreToClientEvent)                                          â”‚
â”‚       â†“                                                                           â”‚
â”‚  MatchScanner (parse game state)                                                 â”‚
â”‚       â”œâ”€ gameObject { grpId: 71234, instanceId: 42, zoneId: 3 }                 â”‚
â”‚       â”œâ”€ Send grpId to â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚       â”‚                                    â”‚                                     â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â†’ ArenaCardDatabase              â”‚
â”‚                                            â”‚      (unified_cards.db)             â”‚
â”‚                                            â”‚      Query: WHERE grpId = 71234    â”‚
â”‚                                            â”‚      Result: "Lightning Bolt"       â”‚
â”‚                                            â”‚                                     â”‚
â”‚  GameObject.name = "Lightning Bolt"  â†â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚       â†“                                                                           â”‚
â”‚  GameStateManager (build board state)                                            â”‚
â”‚       â”‚                                                                           â”‚
â”‚       â””â”€ YOUR HAND: Lightning Bolt, Counterspell                                â”‚
â”‚       â””â”€ OPPONENT BATTLEFIELD: Snapcaster Mage                                  â”‚
â”‚       â†“                                                                           â”‚
â”‚  AIAdvisor._build_prompt()                                                       â”‚
â”‚       â”‚                                                                           â”‚
â”‚       â””â”€ Raw prompt with card names                                             â”‚
â”‚       â†“                                                                           â”‚
â”‚  RAGSystem.enhance_prompt() â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚       â”œâ”€ Get card stats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â†’ CardStatsDB (card_stats.db)        â”‚
â”‚       â”‚  (Lightning Bolt GIH WR: 65%)  â”‚     Query: WHERE card_name = ...      â”‚
â”‚       â”‚                                â”‚     Result: {gih_wr: 0.65, ...}       â”‚
â”‚       â”‚                                â”‚                                        â”‚
â”‚       â”œâ”€ Query rules â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â†’ ChromaDB (rules vector search)     â”‚
â”‚       â”‚  "combat and blocking"         â”‚     Result: [Rule 509.1, ...]         â”‚
â”‚       â”‚                                â”‚                                        â”‚
â”‚       â””â”€ Enhanced prompt with context  â”‚                                        â”‚
â”‚           "Lightning Bolt: 65% WR      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚            (key performer)"                                                      â”‚
â”‚       â†“                                                                           â”‚
â”‚  OllamaClient.generate()                                                         â”‚
â”‚       â†“                                                                           â”‚
â”‚  "Cast Lightning Bolt at the attacker"                                           â”‚
â”‚       â†“                                                                           â”‚
â”‚  TextToSpeech ("Cast Lightning Bolt...")                                         â”‚
â”‚                                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ DRAFT FLOW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                   â”‚
â”‚  Arena Draft Pack (Arena IDs)                                                    â”‚
â”‚  [71234, 71235, 70000, 70001, ...]                                               â”‚
â”‚       â†“                                                                           â”‚
â”‚  DraftAdvisor.recommend_pick()                                                   â”‚
â”‚       â”œâ”€ _resolve_cards()                                                        â”‚
â”‚       â”‚  â”œâ”€ Arena ID â†’ grpId conversion (if needed)                             â”‚
â”‚       â”‚  â””â”€ grpId â†’ card name â”€â”€â†’ ArenaCardDatabase (unified_cards.db)         â”‚
â”‚       â”‚       Result: ["Lightning Bolt", "Counterspell", "Forest"]             â”‚
â”‚       â”‚                                                                           â”‚
â”‚       â”œâ”€ _enrich_with_metadata()                                                â”‚
â”‚       â”‚  â””â”€ Card name â†’ colors/rarity/types â”€â”€â”                                â”‚
â”‚       â”‚     OLD: card_metadata_db              â”‚                                â”‚
â”‚       â”‚     NEW: unified_cards.db â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚       â”‚     Result: DraftCard(name="Lightning Bolt",                           â”‚
â”‚       â”‚                        colors="R", rarity="uncommon")                  â”‚
â”‚       â”‚                                                                           â”‚
â”‚       â”œâ”€ _enrich_with_stats()                                                   â”‚
â”‚       â”‚  â””â”€ Card name â†’ win rates â”€â”€â†’ CardStatsDB (card_stats.db)             â”‚
â”‚       â”‚     Result: DraftCard(..., gih_win_rate=0.65, ata=2.3)                â”‚
â”‚       â”‚                                                                           â”‚
â”‚       â””â”€ _calculate_grades()                                                    â”‚
â”‚          â””â”€ Compare win rates in pack                                           â”‚
â”‚             Result: DraftCard(..., grade="A+", score=95)                      â”‚
â”‚       â†“                                                                           â”‚
â”‚  Display:                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â”‚ Card               â”‚ Grade â”‚  WR  â”‚ ATA â”‚                                    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤                                    â”‚
â”‚  â”‚ Lightning Bolt     â”‚  A+   â”‚ 65%  â”‚ 2.3 â”‚ â† Recommended                      â”‚
â”‚  â”‚ Counterspell       â”‚  A    â”‚ 63%  â”‚ 3.1 â”‚                                    â”‚
â”‚  â”‚ Forest             â”‚  C    â”‚ 53%  â”‚ 8.1 â”‚                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ DATA SOURCES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                   â”‚
â”‚  UNIFIED_CARDS.DB (100MB)                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ grpId  â”‚ name           â”‚ colors â”‚ mana_cost â”‚ oracle_text â”‚    â”‚            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”‚
â”‚  â”‚ 71234  â”‚ Lightning Bolt â”‚ R      â”‚ {R}       â”‚ Deals 3 ... â”‚    â”‚            â”‚
â”‚  â”‚ 71235  â”‚ Counterspell   â”‚ U      â”‚ {1}{U}    â”‚ Counter ... â”‚    â”‚            â”‚
â”‚  â”‚ 70000  â”‚ Forest         â”‚ G      â”‚ {G}       â”‚ {T}: Add ... â”‚    â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚     Used by: Game state (grpId) + Draft advisor (colors, rarity)                â”‚
â”‚     Source: Scryfall (built once, rarely updated)                               â”‚
â”‚                                                                                   â”‚
â”‚  CARD_STATS.DB (50MB)                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ card_name      â”‚ gih_wr â”‚ ata â”‚ iwd â”‚ games_played â”‚    â”‚                  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
â”‚  â”‚ Lightning Bolt â”‚ 0.65   â”‚ 2.3 â”‚ 0.08 â”‚ 8523        â”‚    â”‚                  â”‚
â”‚  â”‚ Counterspell   â”‚ 0.63   â”‚ 3.1 â”‚ 0.06 â”‚ 5234        â”‚    â”‚                  â”‚
â”‚  â”‚ Forest         â”‚ 0.53   â”‚ 8.1 â”‚ 0.02 â”‚ 900         â”‚    â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚     Used by: Draft advisor (grading) + Tactical prompt (context)                â”‚
â”‚     Source: 17lands.com API (quarterly updates)                                â”‚
â”‚     ğŸ”‘ UNIQUE: Only source for win rate data                                    â”‚
â”‚                                                                                   â”‚
â”‚  CARD_METADATA.DB (50MB) â† REDUNDANT                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚ card_name      â”‚ colors â”‚ rarity    â”‚ types      â”‚ â”‚                        â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
â”‚  â”‚ Lightning Bolt â”‚ R      â”‚ uncommon  â”‚ Instant    â”‚ â”‚                        â”‚
â”‚  â”‚ Counterspell   â”‚ U      â”‚ uncommon  â”‚ Instant    â”‚ â”‚                        â”‚
â”‚  â”‚ Forest         â”‚ G      â”‚ common    â”‚ Land       â”‚ â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚     Used by: Draft advisor (colors, rarity, types)                             â”‚
â”‚     âš ï¸  ALL fields are in unified_cards.db - CAN BE REMOVED                     â”‚
â”‚                                                                                   â”‚
â”‚  CHROMADB (5MB)                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚ Rule ID â”‚ Text                  â”‚ Embedding  â”‚ â”‚                            â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                            â”‚
â”‚  â”‚ 509.1   â”‚ "During the declare..." â”‚ [0.2..] â”‚ â”‚                            â”‚
â”‚  â”‚ 701.7b  â”‚ "First strike applies..." â”‚ [0.1..] â”‚ â”‚                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚     Used by: Tactical prompt (rules search)                                    â”‚
â”‚     Source: MTG Comprehensive Rules (annual updates)                           â”‚
â”‚                                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ KEY TAKEAWAYS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                   â”‚
â”‚  âœ… ESSENTIAL DATA:                                                              â”‚
â”‚     â€¢ grpId â†’ card name (only way to parse game log)                            â”‚
â”‚     â€¢ Card name â†’ win rates (only 17lands has this)                             â”‚
â”‚                                                                                   â”‚
â”‚  âš ï¸  REDUNDANT DATA:                                                             â”‚
â”‚     â€¢ card_metadata.db (colors/rarity/types) - already in unified_cards.db     â”‚
â”‚                                                                                   â”‚
â”‚  ğŸš€ OPPORTUNITIES:                                                               â”‚
â”‚     â€¢ Add oracle_text to prompt enhancement                                     â”‚
â”‚     â€¢ Add mana_cost checking for casting validation                             â”‚
â”‚     â€¢ Use Scryfall MCP as fallback                                              â”‚
â”‚                                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
